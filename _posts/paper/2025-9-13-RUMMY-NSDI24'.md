---
title: NSDI 24' - Fast Vector Query Processing for Large Datasets Beyond GPU Memory with Reordered Pipelining
author: blakewoo
date: 2025-9-13 23:00:00 +0900
categories: [Paper]
tags: [Paper, NSDI24] 
render_with_liquid: false
---


# Fast Vector Query Processing for Large Datasets Beyond GPU Memory with Reordered Pipelining
24년 NSDI에 발표된 논문이다. 베이징 대학교에서 발표했으며, Vector DB에서 GPU 사용을 어떻게 하면 효율적으로 할 수 있는지에 대한 내용으로
아주 큰 Dataset을 대상으로 IVF(Inverted File) 방식의 인덱스를 차용한 GPU 메모리 매니저를 포함한 시스템이며
Offline에서 Index build하고 Online에서 서비스는 제공하는 방식이다.
Faiss를 기반으로 통합되었으며 이를 사용해 볼 수 있게 github에 관련 코드도 있다.

## 1. 개요
Deep Learning과 RAG 기술 발달로 인해 Vector DB의 수요가 증가하고 있다.    
수요가 증가함에 따라 성능에 대한 수요와 Dataset의 증가는 같이 이뤄졌는데, 그 과정에서 GPU가 Vector DB에 도입되는 것은
너무 자연스러운 현상이라고 말한다.

하지만 GPU RAM은 한정되어있기 때문에 HOST RAM으로 확장하여 같이 지원할 수 있게끔 많은 연구가 이뤄지고 있다고 한다.
이 과정에서 가장 먼저 생각할 수 있는 것은 Dataset을 GPU RAM 사이즈만큼 나누어서 Rotate 방식으로 구동하는 것인데, 이는 
GPU의 활용률이 낮고, GPU Unified Memory라는 솔루션이 있는데 이는 Vector Data에 대해 고려하지 못하기 때문에 다수의 GPU Page fault를
발생시켜서 성능 저하를 초래한다고 한다.   

위와 같은 문제로 인해 베이징대 연구원들은 GPU RAM의 크기를 벗어난 사이즈의 Dataset을 지원하고 GPU Unified Memory나 Dataset을
나누어서 Rotate하는 방식보다 훨씬 GPU를 잘 사용할 수 있는 솔루션인 RUMMY를 제안했다.

RUMMY의 큰 구조는 아래와 같다.

![img.png](/assets/blog/paper/RUMMY/img.png)

먼저 offline에서 Index를 빌드한다. IVF 방식이기 때문에 K-means를 통해 클러스터를 생성(이때 만들어진 클러스터를 원시 클러스터라고 하겠다)하고
해당 클러스터들을 다시 균등하게 쪼개는 클러스터 Balance 과정을 거친다. 이후에 해당 클러스터(이를 균등 클러스터라고 하겠다)들은 Profiler들을 통해 GPU 전송시간과 GPU 연산 시간을 측정하여
차후에 있을 Online에서 Query 요청하는데 필요한 Metric을 제공한다음에 Host Memory에 적재된다.

이후 실제 서비스를 제공하는 Online 과정에선 사용자가 Query를 입력하면 이를 Batch로 처리하는데 일반 IVF 방식과 같이 클러스터들의
중심점과 Query의 거리를 계산해서 가장 가까운것 K개를 뽑아서 연산할만한 원시 클러스터들을 선정한 뒤 해당 원시 클러스터들이 나뉜 균등 클러스터를 최적의 그룹단위로 묶고 전송 순서를 변경하여
전송하여 클러스터 연산 중(Overlap)에 데이터 전송이 일어나게끔 하고 GPU의 프로세싱 유닛인 SM이 충분히 활용되지 못한다면
해당 균등 클러스터 역시 나누어서 구동함으로써 GPU의 사용률을 높이는 방식이다.

## 2. RUMMY의 구조
### 1) Index build
#### a. IVF Index build
#### b. Cluster balance
#### c. Profiler
#### d. Dataset store

### 2) Search Process
#### a. 원시 클러스터 선정
#### b. Cluster based retrofitting
#### c. Pipelining scheduler
#### d. Dynamic Kernel Padding
#### e. Final result return

> ※ 추가 업데이트 및 퇴고 예정
{: .prompt-tip }


# 참고문헌
- Zili Zhang, , Fangyue Liu, Gang Huang, Xuanzhe Liu, and Xin Jin. "Fast Vector Query Processing for Large Datasets Beyond GPU Memory with Reordered Pipelining." . In 21st USENIX Symposium on Networked Systems Design and Implementation (NSDI 24) (pp. 23–40). USENIX Association, 2024.


