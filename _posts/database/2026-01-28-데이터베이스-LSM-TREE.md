---
title : 데이터 베이스 - LSM Tree(Log-structured merge-tree)
author: blakewoo
date: 2026-1-29 21:00:00 +0900
categories: [Database]
tags: [Database, Algorithm, RocksDB]
render_with_liquid: false
use_math: true
---

# LSM Tree(Log-structured merge-tree)
## 1. 개요
먼저 LSM Tree(Log-Structured Merge-Tree)를 한 마디로 표현하자면 데이터베이스 시스템에서 고속 쓰기(high insert volume)
워크로드를 효율적으로 처리하기 위해 설계된 디스크 기반 데이터 구조이다.   

데이터 베이스의 구조로 그냥 B트리나 B+트리를 많이 사용하지 않느냐고 의문이 들 수 있는데, 사실 데이터 베이스도 종류에 따라서 여러가지 자료구조를   
채택한다(그리고 사실 LSM Tree도 내부적으로 B+ Tree를 부분적으로 차용한 경우도 있다).
그냥 우리가 일반적으로 생각하는 데이터 베이스(Mysql이나 MariaDB 등)가 B+트리를 많이 사용하는 것이고 여기서 말하는 고속 쓰기 워크로드 워크로드란 
말 그대로 읽기는 어느정도 수용할 정도의 성능만 되면 되지만, 쓰기 속도가 매우 중요한 워크로드를 말한다.
가령 시계열 데이터라던지, 혹은 정말로 큰 빅 데이터 같은 것들이 있다.

1996년에 LSM Tree를 처음으로 제시한 Patrick O'Neil이 처음 제안한 이 구조는 특히 Transaction History 테이블, 로그 파일,
시계열 데이터 같이 삽입은 매우 빈번하지만 검색은 드문 응용에서 최적화되어 있다.
일단 O'Neil의 원본 논문은 HDD를 기준으로 서술 되었으며(최초의 SSD가 2006년이다)
LSM Tree를 사용하면 TPC-A 벤치마크에서 필요한 디스크 암(disk arm)을  기존 50개에서 약 10개로 줄일 수 있어, 시스템 비용을 약 80% 절감할 수 있다고 설명했다.

## 2. 구조
기본적으로 LSM Tree의 핵심은 서로 다른 저장 매체에 최적화된 여러 컴포넌트로 구성되는 것이다.   
서로 다른 매체라고 해봐야, 메모리와 디스크 뿐이지만 큰 구조는 아래와 같다.

### 1) Memtable
원 논문에서는 C0 tree라고 되어있지만 현대에는 메모리에 적재되어있다고 Memtable 혹은 L0(Level 0)이라고 부르는 구조이다.
보통 Red-Black Tree, Skip List, 또는 B+ Tree로 구현되어있으며 Write Ahead Log 방식으로 기재한다.
즉, 삭제한다고 하더라도 정말 데이터를 지워버리는게 아니라 tombstone으로 표시해두고 
이후 Memtable이 모두 꽉 차면 병합시에 해당 값을 지우는 방식이다.

### 2) SSTable
원 논문에서는 C1 tree라고 되어있는데 현대에선 일반적으로 L1이라고 부르며 사실 C1 다음에 C2 ... Ck 식으로 좀 더 큰 데이터가 저장된다.   
C1 및 이후의 하위 레벨의 자료구조를 SSTable이라고 하며, 디스크에 적재되어있다.

## 3. Compaction
처음 Memtable에서 지정된 크기나 지정된 노드의 개수가 초과하면 해당 Tree를 C1으로 정렬 병합한다.
이를 Compaction이라고 하는데, 만약 C1에서도 동일하게 지정된 크기나 지정된 노드의 개수를 초과하면 그 다음레벨인 C2에
정렬병합하는식으로 각 하위 레벨로 정렬 병합하는 형태이다.

> ※ 추가 업데이트 예정
{: .prompt-tip }

# 참고 자료
- [위키피디아 - Log-structured merge-tree](https://en.wikipedia.org/wiki/Log-structured_merge-tree)
- O’Neil, Patrick, Edward, Cheng, Dieter, Gawlick, and Elizabeth, O’Neil. "The log-structured merge-tree (LSM-tree)".Acta Inf. 33, no.4 (1996): 351–385.
- Liu, Junfeng, Fan, Wang, Dingheng, Mo, and Siqiang, Luo. "Structural Designs Meet Optimality: Exploring Optimized LSM-tree Structures in a Colossal Configuration Space".Proc. ACM Manag. Data 2, no.3 (2024).



