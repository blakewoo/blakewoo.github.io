---
title: Database - Logging
author: blakewoo
date: 2025-6-19 20:00:00 +0900
categories: [Database]
tags: [Database, DBMS ,Logging]
render_with_liquid: false
use_math: true
---

# Logging

## 1. 개요
DB에 어떤 값을 썼을 때 해당 값의 영속성이 보장되어야하는데 컴퓨터 시스템이라는게 여러가지 이유로 FAIL이 날 수 있다.   
이 FAIL을 Crash라고 하고 Crash로 인해 일관성이 깨진 데이터를 복구 시키는걸 Recovery라고 한다. (사실 그냥 영어로 바꾼거긴하지만)
이 Recovery를 위한 알고리즘은 장애 발생시에도 데이터 베이스 일관성, 트랜잭션 원자성 및 내구성을 보장하는 기술이다.

이 알고리즘은 크게 두 part로 나누게 된다.   
Crash가 터지기전 미리 작업을 해두는 것과, Crash 이후에 하는 처리가 바로 그것이다.   

이번 포스팅은 Crash가 터지기전에 미리 작업을 해두는 방법인 Logging에 대해서 알아보겠다.

## 2. Failure 분류
### 1) Transaction Failures
#### a. 논리적 오류
- 무결성 제약 조건 위반 : Primary 키가 중복되어 삽입된 경우
- 비즈니스 로직 오류 : 금액이 0 이상이어야하는데 이하로 떨어진 경우
- 처리 되지 않은 예외 : 저장 프로시저 내부에서 예외가 발생했지만 제대로 처리되지 않은 경우
#### b. 내부 상태 오류
lock을 쓰는 DBMS의 경우 Deadlock이 발생하여 활성된 트랜잭션을 종료하는 경우

### 2) System Failure
#### a. 소프트웨어 문제
OS나 DBMS의 자체적인 문제이다(가령 0으로 나누기 예외 처리를 안했다던지)

#### b. 하드웨어 문제
컴퓨터가 DBMS를 호스팅하다가 Power가 나가거나 하드웨어적인 문제가 발생하는 경우이다.   
시스템 충돌(예: 정전, 커널 패닉)이 발생하면 시스템은 즉시 깨끗하게 멈추고,
비휘발성 저장소(예: SSD, HDD, NVM)에 이미 기록된 데이터는 손상되지 않는다고 간주한다.
- 손상되지 않음은 사실 비휘발성 저장소를 만드는 부분에서 보증이 되어야한다. 따라서 우리는 일단 그렇게 간주하고 생각한다.

### 3) Storage Media Failures
#### a. 수리 불가능한 하드웨어 오류
헤드 충돌 또는 이와 비슷한 오류로 비휘발성 저장 장치 전체 혹은 일부가 손상   
이 손상은 감지 가능한 것으로 간주되며 문제 발생시 별도의 보관된 버전에서 복원해야한다(RAID된 데이터라던지)

## 3. 데이터베이스의 기본 작동 구조
비휘발성 메모리(HDD나 SSD)는 휘발생 메모리에 기재하는 것보다 훨씬 느리다. 따라서
DBMS에 데이터를 쓸때 아래와 같은 절차를 거친다.

- 먼저 메모리에 데이터를 복사해오고
- 복사된 데이터에서 쓰기 작업을 한뒤
- 쓰기된 데이터를 비휘발성 메모리에 기재한다.

이 과정에서 DBMS는 다음 사항을 보장해야한다.

- 트랜잭션이 이미 커밋된 경우 데이터는 영속적이다.
- 트랜잭션이 중단된 경우 부분적인 변경사항은 영속적으로 처리되지 않는다.

## 4. Redo vs Undo
### 1) Redo
### 2) Undo
## 5. STEAL Policy
## 6. Force Policy
## 7. Shadow Paging
## 8. Write-Ahead Log
## 9. Checkpoint

> ※ 미비된 내용은 추가적인 업데이트가 있을 예정이고 데이터 검증 또한 있을 것이다.
{: .prompt-tip }

# 참고자료
- 서강대학교 김영재 교수님 고급데이터 베이스 강의 자료
- Avi Silberschatz, Henry F. Korth, S. Sudarshan, Database System Concepts(McGraw-Hill, March 2019)
