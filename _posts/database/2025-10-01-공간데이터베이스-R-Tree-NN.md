---
title: 공간 데이터 베이스 - 최근접 이웃 검색(R-tree)
author: blakewoo
date: 2025-10-1 23:00:00 +0900
categories: [Database]
tags: [Computer science, Database, Spacial Database, Nearest Neighbor]
render_with_liquid: false
use_math: true
---

# R-tree에서 최근접 이웃 검색
## 1. 개요
Vector DB에서 말하는 그 최근접 이웃이 맞다. 물론 공간 데이터베이스는 2차원 혹은 3차원을 주로 다루기 때문에 VectorDB의 최근접 이웃 탐색보다
더 먼저이며, ANN을 다루는 것고 달리 공간 데이터 베이스에서는 진짜로 제일 가까운 값을 반환해주어야한다.

이를 위한 방법에 대해서 이번 포스팅간에 알아보겠다.

## 2. Depth-first Search
쿼리를 Q라고 하자. 이 Q에서 가장 가까운 점 또는 객체를 찾기 위한 가장 심플한 방법이다. 
DFS라고 하지만 사실 R 트리를 하나씩 Search해서 알아보는 것과 같다. 각각의 Entry들과 Q를 비교하여 가장 가까운 것을 뽑아내는 것으로
사실상 전체 검색과 다를바 없다.

## 3. Branch and bound
95년도 sigmod에 나온 논문으로 여기서는 각 Node별로 우선순위큐가 있다. 그리고 우선 순위는 기본적으로 MINDIST에 의해 결정되며
가지치기를 위한 MINMAXDIST가 있다. 쿼리를 Q라고 하자.

### 1) MINDIST
MINDIST는 Q에서 대상 MBB에서 가장 가까운 거리를 MINDIST라고 한다. 변에 가깝다면 변에 직교하는 형태이거나, 혹은 모서리에 접하는 형태이다.
모든 MBB에 대해서 MINDIST를 구했을 때 가장 작은 MINDIST보다는 긴 거리에 최근접 이웃이 있다.

![img.png](/assets/blog/database/spacial_database/r_tree_knn/img.png)

### 2) MINMAXDIST
가장 가까운 변의 가장 먼 거리를 말한다. 그래서 가장 가까운(MIN)곳에서 먼(MAX)거리라고 MINMAXDIST이다.   
이 거리가 설명하는 것은 어떤 최근접값은 모든 MBB의 MINMAXDIST중에 가장 작은 값보다 짧은 거리내에 최근접 이웃이 있다는 뜻이다.

![img_1.png](/assets/blog/database/spacial_database/r_tree_knn/img_1.png)

### 3) Branch pruning
위와 같은 MINDIST와 MINMAXDIST를 통해 가지치기를 할 수 있다.

- 상위 노드에서 하위 노드로 탐색시 : 어떤 MBB인 R에 대해서 MINDIST가 어떤 MBB인 R'의 MINMAXDIST보다 크다면 R에 대해서 탐색하지 않아도 된다.
- 상위 노드에서 하위 노드로 탐색시 : 어떤 MBB인 R에 대해서 실질 객체 O와의 거리가 R의 MINMAXDIST보다 크다면 객체 O는 탐색하지 않아도 된다.
- 하위에서 상위노드로 다시 올라올시 : 어떤 MBB인 R에 대해서 실질 객체 O와의 거리가 R의 MINDIST 보다 작다면 R은 더 탐색하지 않아도 된다.

> 추가 업데이트 예정
{: .prompt-tip }


## 4. Best-First
## 5. Full Blown Algorithm

> 추가 업데이트 예정
{: .prompt-tip }

# 참고자료
- Shashi Shekhar and Sanjay Chawla, Spatial Databases: A Tour, Prentice Hall, 2003
- P. RIigaux, M. Scholl, and A. Voisard, SPATIAL DATABASES With Application to GIS, Morgan Kaufmann Publishers, 2002
