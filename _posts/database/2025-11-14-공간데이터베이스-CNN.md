---
title: 공간 데이터 베이스 - CNN(Continuous Nearest Neighbor)
author: blakewoo
date: 2025-11-14 23:30:00 +0900
categories: [Database]
tags: [Computer science, Database, Spacial Database, CNN]
render_with_liquid: false
use_math: true
---

# CNN(Continuous Nearest Neighbor)
## 1. 개요
연속 최근접 이웃 쿼리는 쿼리 선분(query segment)을 따라 이동하면서 각 구간별로 가장 가까운 데이터 포인트를 찾는 문제이다.
목표는 데이터셋을 한 번만 순회하여 모든 분할 지점(split points)과 각 구간의 최근접 이웃을 찾는 것이다.

아래의 그림을 보자

![img.png](/assets/blog/database/spacial_database/cnn/img.png)

s에서 e까지 이동한다고 할때 각각 a~h 에서 가장 가까운 점을 찾는 문제라고 생각하면 된다. 

## 2. 핵심 Lemma

### 1) Lemma 1
분할 리스트와 새로운 데이터 포인트 p가 주어졌을 때, p가 쿼리 선분의 어떤 지점을 커버하는 것은 p가 분할 지점을 커버하는 것과 같은 말이다.

### 2) Lemma 2 (Covering Continuity)
포인트 p가 커버하는 분할 지점들은 연속적이다. 즉, p가 분할 지점 s를 커버하지만 s₋₁이나 s₊₁을 커버하지 않는다면, p는 그 이후의 분할 지점들도 커버할 수 없다.

## 3. Algorithm with R-trees Overview
### 1) Heuristic
#### a 
중간 엔트리 E와 쿼리 선분 q에 대해, E의 서브트리가 유효한 포인트를 포함할 수 있으려면 mindist(E,q) < SLMAXD를 만족해야 한다. 여기서 SLMAXD는 분할 지점과 그 최근접 이웃 간의 최대 거리를 말한다.

#### b
중간 엔트리 E의 서브트리를 탐색해야 하는 조건은, 분할 리스트에 dist(sᵢ, sᵢ.NN) > mindist(sᵢ, E)를 만족하는 분할 지점 sᵢ가 존재할 때이다. 이 휴리스틱은 Heuristic 1을 통과한 경우에만 적용된다.

#### c 
Heuristic 1과 2를 만족하는 엔트리들은 쿼리 선분 q까지의 최소 거리가 증가하는 순서로 접근한다.

### 2) 알고리즘
리프 엔트리(데이터 포인트) p를 만나면:
1) p가 커버하는 분할 지점들의 집합 SCOVERS를 검색한다.
2) SCOVERS가 비어있지 않으면 Split List를 업데이트한다. 이진 탐색을 사용하여 모든 분할 지점과 비교하는 것을 피하고 효율성을 높인다

업데이트 과정에서는 이전 최근접 이웃과 새로운 포인트 사이의 수직 이등분선과 쿼리 선분의 교점에 새로운 분할 지점을 추가하고, 기존 분할 지점들을 제거한다.

알고리즘은 R-tree에서 깊이 우선 탐색을 수행하며, branch-and-bound 기법으로 탐색 공간을 줄인다

# 참고자료
- Shashi Shekhar and Sanjay Chawla, Spatial Databases: A Tour, Prentice Hall, 2003
- P. RIigaux, M. Scholl, and A. Voisard, SPATIAL DATABASES With Application to GIS, Morgan Kaufmann Publishers, 2002
