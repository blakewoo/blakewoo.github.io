---
title: 32bit kernel - 2
author: blakewoo
date: 2024-2-29 23:05:00 +0900
categories: [OS]
tags: [OS]
render_with_liquid: false
---

# 페이징 및 세그멘테이션 설정
이전에 페이징과 세그멘테이션에 대한 포스팅을 진행한 적이 있다.
페이징과 세그멘테이션을 소프트웨어적인 방법으로 구현하여 사용할 수도 있겠지만 으레 그러하듯
하드웨어적으로 구현된 것 보단 성능이 떨어진다. 그렇기 때문에 아키텍처 자체에서
페이징과 세그멘테이션을 지원한다.

페이징과 세그멘테이션을 활성화하기 위해서 우리가 살펴봐야할 부분은 다름아닌 컨트롤 레지스터이다.

## 컨트롤 레지스터
컨트롤 레지스터는 32bit에선 CR0~CR4까지, 64bit에선 CR0~CR3, CR8가 있다.
이러한 각각의 레지스터의 기능은 아래와 같다.

<table>
<th>
컨트롤 레지스터의 이름
</th>
<th>
기능
</th>
<tr>
<td>
CR0
</td>
<td>
 운영 모드를 전반적으로 제어한다. 리얼모드에서 보호 모드로 전환, 페이징 기능 활성화, 캐시 기능 등을 담당
</td>
</tr>
<td>
CR1
</td>
<td>
사용되지 않음
</td>
<tr>
<td>
CR2
</td>
<td>
페이지 폴트가 난 주소를 갖고 있는 레지스터(페이징 기능 활성화시에만 제대로된 값을 갖고있음)
</td>
</tr>
<tr>
<td>
CR3
</td>
<td>
페이징 디렉터리의 물리주소와 페이징 캐시에 대해서 설정하는 레지스터
</td>
</tr>
<tr>
<td>
CR4
</td>
<td>
페이징 크기 확장이나 메모리 영역 확장과 같이 프로세서에서 지원하는 기능을 쓰기 위한 레지스터
</td>
</tr>
<tr>
<td>
CR8
</td>
<td>
태스크 우선순위 레지스터 값을 제어하는 레지스터이며 프로세서 외부에서 발생하는 인터럽트를 걸러준다.
64bit 모드일때만 유효하다.
</td>
</tr>
</table>

여기서 보호모드로 전환하는데 필요한 레지스터는 CR0이며 32bit로 이루어진 이 CR0 레지스터의
PE를 1으로 세팅하면 보호 모드로 전환되고, 페이징을 쓰려면 PG를 1로 쓰지 않으려면 0으로 세팅하면 된다.


# 참고 문헌
1. 64Bit 멀티코어 OS의 구조 - 한승훈 저
2. Intel® 64 and IA-32 Architectures
   Software Developer’s Manual
   Volume 3A:
   System Programming Guide, Part 1
